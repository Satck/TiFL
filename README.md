# TiFL è®ºæ–‡å¤ç°é¡¹ç›®

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯å¯¹è®ºæ–‡ã€ŠTiFL: A Tier-based Federated Learning System (arXiv:2001.09249)ã€‹çš„å®Œæ•´å¤ç°å®ç°ã€‚

## é¡¹ç›®ç»“æ„

```
tifl_project/
â”œâ”€â”€ data/                    # æ•°æ®åŠ è½½ä¸Non-IIDåˆ’åˆ†
â”‚   â””â”€â”€ loader.py           # æ•°æ®é›†åŠ è½½å’ŒNon-IIDåˆ’åˆ†
â”œâ”€â”€ models/                 # æ¨¡å‹å®šä¹‰
â”‚   â””â”€â”€ networks.py         # CNNæ¨¡å‹å®šä¹‰
â”œâ”€â”€ core/                   # æ ¸å¿ƒç»„ä»¶
â”‚   â”œâ”€â”€ client.py           # å®¢æˆ·ç«¯å®ç°
â”‚   â”œâ”€â”€ server.py           # æœåŠ¡å™¨ç«¯FedAvgèšåˆ
â”‚   â””â”€â”€ tiering.py          # åˆ†å±‚ç³»ç»Ÿå’Œè‡ªé€‚åº”è°ƒåº¦å™¨
â”œâ”€â”€ strategies/             # é€‰æ‹©ç­–ç•¥
â”‚   â””â”€â”€ selector.py         # 5ç§å®¢æˆ·ç«¯é€‰æ‹©ç­–ç•¥
â”œâ”€â”€ experiments/            # å®éªŒæ‰§è¡Œ
â”‚   â””â”€â”€ trainer.py          # ä¸»è®­ç»ƒæµç¨‹
â”œâ”€â”€ results/                # ç»“æœå­˜å‚¨
â”‚   â”œâ”€â”€ metrics/           # å®éªŒæŒ‡æ ‡
â”‚   â”œâ”€â”€ plots/             # å¯è§†åŒ–å›¾è¡¨
â”‚   â””â”€â”€ logs/              # è®­ç»ƒæ—¥å¿—
â”œâ”€â”€ config.yaml            # å®éªŒé…ç½®
â”œâ”€â”€ main.py                # ä¸»æ‰§è¡Œè„šæœ¬
â”œâ”€â”€ visualize.py           # ç»“æœå¯è§†åŒ–
â”œâ”€â”€ run_all.sh             # æ‰¹é‡è¿è¡Œè„šæœ¬
â””â”€â”€ requirements.txt       # ä¾èµ–åŒ…
```

## å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

## ä½¿ç”¨æ–¹æ³•

### 1. å•ä¸ªå®éªŒè¿è¡Œ

```bash
# è¿è¡Œ MNIST + vanilla ç­–ç•¥
python main.py --dataset mnist --strategy vanilla

# è¿è¡Œ MNIST + TiFL è‡ªé€‚åº”ç­–ç•¥
python main.py --dataset mnist --strategy adaptive

# è¿è¡Œ CIFAR-10 + fast ç­–ç•¥
python main.py --dataset cifar10 --strategy fast
```

### 2. æ‰¹é‡è¿è¡Œæ‰€æœ‰å®éªŒ

```bash
./run_all.sh
```

### 3. å¯è§†åŒ–ç»“æœ

```bash
# ç”Ÿæˆ MNIST çš„å¯¹æ¯”å›¾
python visualize.py --dataset mnist

# ç”Ÿæˆæ‰€æœ‰æ•°æ®é›†çš„å¯¹æ¯”å›¾
for dataset in mnist fashion_mnist cifar10; do
    python visualize.py --dataset $dataset
done
```

## å®éªŒé…ç½®

å®éªŒå‚æ•°åœ¨ `config.yaml` ä¸­é…ç½®ï¼ŒåŒ…æ‹¬ï¼š

- **æ•°æ®é›†**: MNIST, Fashion-MNIST, CIFAR-10
- **ç­–ç•¥**: vanilla, uniform, fast, slow, adaptive (TiFL)
- **å®¢æˆ·ç«¯æ•°é‡**: 50
- **è®­ç»ƒè½®æ•°**: 500
- **æ¯è½®é€‰æ‹©å®¢æˆ·ç«¯æ•°**: 5
- **å±‚çº§æ•°é‡**: 5

## é¢„æœŸç»“æœ

æ ¹æ®è®ºæ–‡ï¼ŒTiFL (adaptive) ç­–ç•¥åº”è¯¥åœ¨ä¿æŒå‡†ç¡®ç‡çš„åŒæ—¶ï¼Œè®­ç»ƒæ—¶é—´æ¯” vanilla ç­–ç•¥å¿« **3-5å€**ã€‚

## ä¸»è¦ç‰¹æ€§

1. **å®Œæ•´å¤ç°**: åŒ…å«è®ºæ–‡ä¸­çš„æ‰€æœ‰ç»„ä»¶å’Œç­–ç•¥
2. **Non-IIDæ•°æ®**: ç¬¦åˆè”é‚¦å­¦ä¹ åœºæ™¯çš„æ•°æ®åˆ†å¸ƒ
3. **åˆ†å±‚ç³»ç»Ÿ**: åŸºäºå®¢æˆ·ç«¯å»¶è¿Ÿçš„5å±‚åˆ†å±‚
4. **è‡ªé€‚åº”è°ƒåº¦**: åŸºäºCreditsæœºåˆ¶çš„æ™ºèƒ½å®¢æˆ·ç«¯é€‰æ‹©
5. **å…¨é¢è¯„ä¼°**: å‡†ç¡®ç‡ã€æŸå¤±ã€è®­ç»ƒæ—¶é—´ç­‰å¤šç»´åº¦æŒ‡æ ‡
6. **å¯è§†åŒ–**: è‡ªåŠ¨ç”Ÿæˆå¯¹æ¯”å›¾è¡¨

## éªŒè¯æ ‡å‡†

- MNIST vanilla: 500è½®è¾¾åˆ° ~95% å‡†ç¡®ç‡
- TiFL è®­ç»ƒæ—¶é—´æ¯” vanilla å¿« 3-5å€
- Fast ç­–ç•¥å‡†ç¡®ç‡ç•¥ä½ (~2-3%)
- Slow ç­–ç•¥æ—¶é—´æœ€é•¿ä½†å‡†ç¡®ç‡æœ€é«˜

## æ•…éšœæ’æŸ¥

å¦‚é‡åˆ°å†…å­˜ä¸è¶³é—®é¢˜ï¼Œå¯åœ¨ main.py å¼€å¤´æ·»åŠ ï¼š
```python
import tensorflow as tf
gpus = tf.config.list_physical_devices('GPU')
for gpu in gpus:
    tf.config.experimental.set_memory_growth(gpu, True)
```

å¦‚éœ€åŠ å¿«æµ‹è¯•é€Ÿåº¦ï¼Œå¯ä¿®æ”¹ config.yaml ä¸­çš„å‚æ•°ï¼š
```yaml
common:
  num_clients: 25    # ä»50å‡å°‘åˆ°25
  num_rounds: 250    # ä»500å‡å°‘åˆ°250
```
--------------------------------------------------------------------------------

ğŸ” ç¬¬ 100 è½®å„ç­–ç•¥å¯¹æ¯”
================================================================================
          ç­–ç•¥        å‡†ç¡®ç‡        æŸå¤±å€¼         è®­ç»ƒæ—¶é—´         ç´¯è®¡æ—¶é—´
--------------------------------------------------------------------------------
     vanilla          0.8416       0.5184         2.56s            396.7s
     uniform          0.8324       0.6261         0.99s            451.0s
        fast          0.8106       2.1604         0.34s            403.7s
        slow          0.8287       1.5509         2.79s            408.6s
    adaptive          0.9544       0.1459         0.68s            391.0s


ğŸ” ç¬¬ 500 è½®å„ç­–ç•¥å¯¹æ¯”
================================================================================
          ç­–ç•¥        å‡†ç¡®ç‡        æŸå¤±å€¼         è®­ç»ƒæ—¶é—´         ç´¯è®¡æ—¶é—´
--------------------------------------------------------------------------------
     vanilla          0.9312       0.3797         2.72s           1977.9s
     uniform          0.8799       0.4818         1.38s           2167.5s
        fast          0.8167       3.3746         0.35s           2098.7s
        slow          0.8717       2.4945         2.65s           2046.9s
    adaptive          0.9509       0.2417         2.68s           2019.9s

ç»“æœå±•ç¤ºï¼š
![img.png](img.png)